{% extends 'booking/base.html' %}
{% load crispy_forms_tags %}

{% block title %}Book Travel - Travel Booking{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="fas fa-ticket-alt"></i> Book Your Travel</h4>
            </div>
            <div class="card-body">
                <!-- Travel Details -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Travel Details</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Travel ID:</strong> {{ travel_option.travel_id }}</p>
                                <p><strong>Type:</strong> 
                                    <i class="fas fa-{% if travel_option.type == 'flight' %}plane{% elif travel_option.type == 'train' %}train{% else %}bus{% endif %}"></i>
                                    {{ travel_option.get_type_display }}
                                </p>
                                <p><strong>From:</strong> {{ travel_option.source }}</p>
                                <p><strong>To:</strong> {{ travel_option.destination }}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Date & Time:</strong> {{ travel_option.date_time|date:"M d, Y H:i" }}</p>
                                <p><strong>Price per seat:</strong> <span class="text-primary">${{ travel_option.price }}</span></p>
                                <p><strong>Available seats:</strong> {{ travel_option.available_seats }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Booking Form -->
                <form method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="{{ form.number_of_seats.id_for_label }}" class="form-label">Number of Seats</label>
                        {{ form.number_of_seats }}
                        {% if form.number_of_seats.errors %}
                            <div class="text-danger">{{ form.number_of_seats.errors }}</div>
                        {% endif %}
                        <div class="form-text">Maximum {{ travel_option.available_seats }} seats available</div>
                    </div>
                    
                    <div class="card bg-light mb-3">
                        <div class="card-body">
                            <h6>Booking Summary</h6>
                            <p class="mb-1">Price per seat: ${{ travel_option.price }}</p>
                            <p class="mb-1">Number of seats: <span id="selected-seats">1</span></p>
                            <hr>
                            <h5 class="text-primary">Total: $<span id="total-price">{{ travel_option.price }}</span></h5>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-credit-card"></i> Confirm Booking
                        </button>
                        <a href="{% url 'travel_list' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Travel List
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const seatsInput = document.getElementById('id_number_of_seats');
    const selectedSeatsSpan = document.getElementById('selected-seats');
    const totalPriceSpan = document.getElementById('total-price');
    const pricePerSeat = {{ travel_option.price }};
    
    seatsInput.addEventListener('input', function() {
        const numSeats = parseInt(this.value) || 1;
        selectedSeatsSpan.textContent = numSeats;
        totalPriceSpan.textContent = (numSeats * pricePerSeat).toFixed(2);
    });
});
</script>
{% endblock %}